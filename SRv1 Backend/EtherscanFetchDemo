const axios = require('axios');
const mysql = require('mysql2');

// Connect to the MySQL database
const connection = mysql.createConnection({
    host: '127.0.0.1',
    user: 'root',
    password: 'root123',
    database: 'standaregtest1',
});

// Define the block number and API key
const blockNumber = 16611560;
const apiKey = "D3FXXA5QGPTMBIPNPUKCW1IW4E8ZGGU4WZ";

// Define the URL to fetch the data from Etherscan
const url = `https://api.etherscan.io/api?module=block&action=getblockreward&blockno=${blockNumber}&apikey=${apiKey}`;

// Use Axios to fetch the data from Etherscan
axios.get(url)
  .then(response => {
    // Parse the data from Etherscan
    const data = response.data.result;

    // Define the variables to be inserted into the database
    const blockHeight = data.blockHeight;
    const blockReward = data.blockReward;
    const totalDifficulty = data.totalDifficulty;
    const transactions = data.transactions;
    const size = data.size;
    const feeRecipient = data.feeRecipient;

    // Insert the data into the MySQL database
    const sql = `INSERT INTO ethereum_data (totalDifficulty, blockHeight, blockReward, size, feeRecipient, transactions)
                 VALUES (${totalDifficulty}, ${blockHeight}, ${blockReward}, ${size}, '${feeRecipient}', ${transactions})`;
    connection.query(sql, (error, results) => {
      if (error) throw error;
      console.log(`Data inserted successfully into ethereum_data with ID: ${results.insertId}`);
    });
  })
  .catch(error => {
    console.error(error);
  });
